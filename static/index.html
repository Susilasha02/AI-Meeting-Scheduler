<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Meeting Scheduler</title>
<style>
  :root {
    --bg: linear-gradient(180deg,#eef2ff,#f9fafb);
    --accent: #4f46e5;
    --accent2: #06b6d4;
    --text: #0f172a;
    --muted: #6b7280;
    --card: #fff;
    --radius: 16px;
    --shadow: 0 10px 40px rgba(0,0,0,0.05);
  }
  html,body {
    height:100%; margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text); background:var(--bg);
  }
  body {
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    min-height:100vh; padding:40px 20px;
  }
  .app {
    width:100%; max-width:1100px;
    background:var(--card);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:32px;
    display:flex; flex-direction:column;
    gap:20px;
    animation: fadeIn .6s ease;
  }
  @keyframes fadeIn {
    from {opacity:0; transform:translateY(10px);}
    to {opacity:1; transform:translateY(0);}
  }
  header {
    display:flex; align-items:center; gap:14px;
  }
  .logo {
    width:56px; height:56px;
    border-radius:14px;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    color:white; font-weight:700; font-size:20px;
    display:flex; align-items:center; justify-content:center;
  }
  h1 { margin:0; font-size:22px; }
  p.lead { margin:6px 0 0; color:var(--muted); }

  textarea {
    width:100%; min-height:70px; resize:vertical;
    border-radius:10px; border:1px solid #e5e7eb;
    padding:12px; font-size:15px;
  }

  input.participants {
    width:100%; padding:10px;
    border-radius:10px; border:1px solid #e5e7eb;
  }

  .controls { display:flex; flex-wrap:wrap; gap:16px; }

  button {
    border:0; cursor:pointer; border-radius:10px; padding:10px 18px;
    font-weight:600; transition:all .2s ease;
  }
  .btn-primary {
    background:linear-gradient(90deg,var(--accent),var(--accent2)); color:white;
  }
  .btn-primary:hover { transform:translateY(-1px); box-shadow:0 3px 10px rgba(79,70,229,0.25); }
  .btn-secondary {
    background:white; color:var(--accent);
    border:1px solid #e5e7eb;
  }

  .toggle { display:inline-flex; align-items:center; gap:8px; color:var(--muted); font-size:14px; }
  .switch {
    --w:48px; --h:26px; width:var(--w); height:var(--h);
    background:#e6e9ef; border-radius:999px;
    padding:3px; display:inline-flex; align-items:center;
    cursor:pointer; transition:background .2s ease;
  }
  .knob {
    width:20px; height:20px; border-radius:999px;
    background:white; box-shadow:0 2px 6px rgba(0,0,0,0.15);
    transition:transform .18s ease;
  }
  .switch.on { background:linear-gradient(90deg,var(--accent),var(--accent2)); }
  .switch.on .knob { transform:translateX(22px); }

  .msg { padding:12px; background:#f1f5f9; border-radius:10px; color:#111; }
  .suggestions { display:grid; gap:12px; margin-top:12px; }
  .slot {
    background:linear-gradient(180deg,#fff,#f9fafb);
    border:1px solid #e5e7eb; border-radius:10px; padding:14px;
    transition:box-shadow .2s ease;
  }
  .slot:hover { box-shadow:0 4px 18px rgba(0,0,0,0.05); }
  .slot h4 { margin:0; font-size:16px; color:var(--text); }
  .slot .meta { color:var(--muted); font-size:13px; margin-top:4px; }
  .slot .actions { margin-top:8px; display:flex; gap:10px; }
  a.link { color:var(--accent); font-weight:600; text-decoration:none; }

  footer { text-align:center; font-size:13px; color:var(--muted); margin-top:12px; }
  @media (max-width:768px){
    .app{padding:22px;}
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">TS</div>
    <div>
      <h1>AI Meeting Scheduler</h1>
      <p class="lead">Book meetings via natural language. Works seamlessly in Teams.</p>
    </div>
  </header>

  <div>
    <textarea id="prompt" placeholder='e.g. "Schedule 30 min with Alex tomorrow"'></textarea>
  </div>

  <div class="controls">
    <button class="btn-primary" id="suggestBtn">Suggest</button>
    <button class="btn-secondary" id="connectBtn" onclick="window.location='/auth/start?next=/ui/'">Connect Google</button>
    <div class="toggle" title="When ON, scheduler limits to today">
      <div id="todaySwitch" class="switch" onclick="toggleSwitch()"><div class="knob"></div></div>
      <span>Today only</span>
    </div>
    <input id="participants" class="participants" placeholder="alice@example.com, bob@example.com" />
  </div>

  <div id="messages"></div>
  <div class="suggestions" id="suggestions"></div>

  <footer>© AI Meeting Scheduler — integrated with Google Calendar & Teams</footer>
</div>

<script>
let todayOnly = false;
function toggleSwitch(){
  const el = document.getElementById('todaySwitch');
  todayOnly = !todayOnly;
  el.classList.toggle('on', todayOnly);
}
function showMessage(msg){
  document.getElementById('messages').innerHTML = `<div class="msg">${msg}</div>`;
}
async function suggest(){
  const prompt = document.getElementById('prompt').value.trim();
  const participants = document.getElementById('participants').value.trim();
  if(!prompt){ showMessage('Please enter a prompt'); return; }
  showMessage('Finding best slots...');
  try{
    const res = await fetch('/suggest', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        prompt,
        today_only: todayOnly,
        attendees: participants ? participants.split(',').map(s=>s.trim()): ["primary"]
      })
    });
    const data = await res.json();
    if(!res.ok){ showMessage('Error: '+(data.error||JSON.stringify(data))); return; }
    renderSuggestions(data);
  }catch(e){ showMessage('Network error: '+e.message); }
}
function renderSuggestions(list){
  const box = document.getElementById('suggestions');
  if(!list.length){ box.innerHTML='<div class="msg">No slots found.</div>'; return; }
  box.innerHTML = list.map((s,i)=>`
    <div class="slot">
      <h4>${s.human}</h4>
      <div class="meta">Score: ${s.score} — ${s.explanation.readable}</div>
      <div class="actions">
        <button class="btn-primary" onclick="book(${i})">Book</button>
        <a href="#" class="link" onclick="alert('You’ll get calendar link after booking');return false;">Open in Calendar</a>
      </div>
    </div>`).join('');
  window.__SUGGS = list;
  document.getElementById('messages').innerHTML='';
}
async function book(idx){
  const s = (window.__SUGGS||[])[idx];
  const participants = document.getElementById('participants').value.trim();
  showMessage('Booking...');
  try{
    const res = await fetch('/book', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        start: s.start, end: s.end,
        attendees: participants ? participants.split(',').map(x=>x.trim()):[],
        subject:"AI Meeting",
        why:s.explanation.readable,
        time_zone: Intl.DateTimeFormat().resolvedOptions().timeZone
      })
    });
    const data = await res.json();
    if(res.ok){ showMessage('Booked! Opening calendar...'); if(data.htmlLink) window.open(data.htmlLink,'_blank'); }
    else showMessage('Error: '+(data.error||JSON.stringify(data)));
  }catch(e){ showMessage('Error: '+e.message); }
}
document.getElementById('suggestBtn').addEventListener('click', suggest);
</script>
</body>
</html>
